import React, { useState, useEffect } from 'react';
import { 
  Calendar, MapPin, Coffee, Utensils, AlertCircle, 
  Trash2, Plus, ExternalLink, Save, Printer, Edit3, 
  Sun, Cloud, CloudRain, Snowflake, Train, Ticket
} from 'lucide-react';

// 預設資料結構
const INITIAL_DAYS = Array.from({ length: 7 }, (_, i) => ({
  id: i + 1,
  date: `Day ${i + 1}`,
  weather: 'sunny',
  transport: '',
  ticketType: 'IC Card', // 'Ticket', 'Pass', 'IC Card'
  accommodation: '',
  schedule: [
    { id: Date.now(), time: '09:00', activity: '抵達京都車站', link: '' },
    { id: Date.now() + 1, time: '12:00', activity: '午餐', link: '' }
  ],
  shopping: [],
  food: {
    wishlist: [],
    breakfast: '',
    lunch: '',
    dinner: ''
  },
  notes: ''
}));

const WeatherIcon = ({ type, className }) => {
  switch (type) {
    case 'sunny': return <Sun className={`text-orange-500 ${className}`} />;
    case 'cloudy': return <Cloud className={`text-gray-500 ${className}`} />;
    case 'rainy': return <CloudRain className={`text-blue-500 ${className}`} />;
    case 'snowy': return <Snowflake className={`text-cyan-500 ${className}`} />;
    default: return <Sun className={`text-orange-500 ${className}`} />;
  }
};

export default function App() {
  // 狀態管理
  const [days, setDays] = useState(INITIAL_DAYS);
  const [activeDayId, setActiveDayId] = useState(1);
  const [isPreviewMode, setIsPreviewMode] = useState(false);

  // 初始化讀取 LocalStorage
  useEffect(() => {
    const savedData = localStorage.getItem('kyoto_trip_data');
    if (savedData) {
      try {
        setDays(JSON.parse(savedData));
      } catch (e) {
        console.error("讀取存檔失敗", e);
      }
    }
  }, []);

  // 自動儲存到 LocalStorage
  useEffect(() => {
    localStorage.setItem('kyoto_trip_data', JSON.stringify(days));
  }, [days]);

  const activeDay = days.find(d => d.id === activeDayId) || days[0];

  // 更新當前天數的特定欄位
  const updateDay = (field, value) => {
    setDays(prev => prev.map(day => 
      day.id === activeDayId ? { ...day, [field]: value } : day
    ));
  };

  // --- 行程表邏輯 ---
  const addScheduleItem = () => {
    const newItem = { id: Date.now(), time: '10:00', activity: '', link: '' };
    const updatedSchedule = [...activeDay.schedule, newItem].sort((a, b) => a.time.localeCompare(b.time));
    updateDay('schedule', updatedSchedule);
  };

  const updateScheduleItem = (id, field, value) => {
    let updatedSchedule = activeDay.schedule.map(item => 
      item.id === id ? { ...item, [field]: value } : item
    );
    // 如果修改的是時間，重新排序
    if (field === 'time') {
      updatedSchedule.sort((a, b) => a.time.localeCompare(b.time));
    }
    updateDay('schedule', updatedSchedule);
  };

  const deleteScheduleItem = (id) => {
    updateDay('schedule', activeDay.schedule.filter(item => item.id !== id));
  };

  // --- 購物清單邏輯 ---
  const addShopItem = () => {
    const newItem = { id: Date.now(), name: '', location: '' };
    updateDay('shopping', [...activeDay.shopping, newItem]);
  };

  const updateShopItem = (id, field, value) => {
    updateDay('shopping', activeDay.shopping.map(item => 
      item.id === id ? { ...item, [field]: value } : item
    ));
  };

  const deleteShopItem = (id) => {
    updateDay('shopping', activeDay.shopping.filter(item => item.id !== id));
  };

  // --- 美食區邏輯 ---
  const addFoodWish = () => {
    const newItem = { id: Date.now(), name: '', note: '', checked: false };
    updateDay('food', { ...activeDay.food, wishlist: [...activeDay.food.wishlist, newItem] });
  };

  const updateFoodWish = (id, field, value) => {
    updateDay('food', {
      ...activeDay.food,
      wishlist: activeDay.food.wishlist.map(item => item.id === id ? { ...item, [field]: value } : item)
    });
  };

  const deleteFoodWish = (id) => {
    updateDay('food', {
      ...activeDay.food,
      wishlist: activeDay.food.wishlist.filter(item => item.id !== id)
    });
  };

  // --- 匯出功能 ---
  const handlePrint = () => {
    setIsPreviewMode(true);
    setTimeout(() => {
      window.print();
      // 列印對話框關閉後可以選擇是否要切換回來，這裡保持預覽模式讓使用者確認
    }, 100);
  };

  const handleExportText = () => {
    let text = `京都七日遊行程表\n\n`;
    days.forEach(day => {
      text += `=== ${day.date} ===\n`;
      text += `天氣: ${day.weather} | 交通: ${day.transport} (${day.ticketType}) | 住宿: ${day.accommodation}\n`;
      text += `--- 行程 ---\n`;
      day.schedule.forEach(item => {
        text += `${item.time} ${item.activity} ${item.link ? `[連結: ${item.link}]` : ''}\n`;
      });
      text += `\n`;
    });
    
    const blob = new Blob([text], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = '京都行程.txt';
    a.click();
    URL.revokeObjectURL(url);
  };

  return (
    <div className="min-h-screen bg-stone-100 font-sans text-stone-800">
      {/* 頂部導航列 (列印時隱藏) */}
      {!isPreviewMode && (
        <header className="bg-indigo-900 text-white p-4 shadow-lg sticky top-0 z-50">
          <div className="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
            <h1 className="text-2xl font-bold flex items-center gap-2">
              <MapPin className="text-pink-400" /> 京都自由行規劃
            </h1>
            <div className="flex gap-2 flex-wrap justify-center">
              {days.map(day => (
                <button
                  key={day.id}
                  onClick={() => setActiveDayId(day.id)}
                  className={`px-3 py-1 rounded-full text-sm font-medium transition-colors ${
                    activeDayId === day.id 
                    ? 'bg-pink-500 text-white' 
                    : 'bg-indigo-800 text-gray-300 hover:bg-indigo-700'
                  }`}
                >
                  Day {day.id}
                </button>
              ))}
            </div>
            <div className="flex gap-2">
              <button 
                onClick={handleExportText}
                className="flex items-center gap-1 px-3 py-2 bg-indigo-700 hover:bg-indigo-600 rounded text-sm"
              >
                <Save size={16} /> 文字檔
              </button>
              <button 
                onClick={handlePrint}
                className="flex items-center gap-1 px-3 py-2 bg-emerald-600 hover:bg-emerald-500 rounded text-sm"
              >
                <Printer size={16} /> 匯出PDF
              </button>
            </div>
          </div>
        </header>
      )}

      {/* 預覽模式的控制列 */}
      {isPreviewMode && (
        <div className="bg-gray-800 text-white p-2 text-center print:hidden sticky top-0 z-50">
          <p className="inline mr-4">目前為預覽列印模式</p>
          <button 
            onClick={() => setIsPreviewMode(false)}
            className="px-3 py-1 bg-gray-600 rounded text-sm hover:bg-gray-500"
          >
            返回編輯模式
          </button>
          <button 
            onClick={() => window.print()}
            className="ml-2 px-3 py-1 bg-emerald-600 rounded text-sm hover:bg-emerald-500"
          >
            列印
          </button>
        </div>
      )}

      <main className="max-w-6xl mx-auto p-4 md:p-6 space-y-6 print:p-0 print:max-w-none">
        
        {/* 如果是預覽模式，我們可能想一次顯示所有天數，或者只顯示當前天數。
            為了 PDF 匯出需求，通常是一次印出所有天數比較方便。
            這裡我們做個邏輯：編輯模式顯示單天，預覽模式顯示所有天數 (方便一次轉 PDF)。
        */}
        {(isPreviewMode ? days : [activeDay]).map((day) => (
          <div key={day.id} className="bg-white rounded-xl shadow-md overflow-hidden print:shadow-none print:break-after-page mb-8 border border-stone-200">
            
            {/* 卡片標題區 */}
            <div className="bg-stone-50 p-4 border-b border-stone-200 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
              <div className="flex items-center gap-3">
                <span className="bg-indigo-900 text-white text-xl font-bold px-3 py-1 rounded">Day {day.id}</span>
                {/* 日期編輯 (編輯模式) / 顯示 (預覽模式) */}
                {isPreviewMode ? (
                   <span className="text-xl font-semibold text-stone-700">{day.date}</span>
                ) : (
                  <input
                    type="text"
                    value={day.date}
                    onChange={(e) => {
                      const newDays = days.map(d => d.id === day.id ? { ...d, date: e.target.value } : d);
                      setDays(newDays);
                    }}
                    className="text-xl font-semibold bg-transparent border-b border-dashed border-stone-300 focus:border-indigo-500 outline-none w-48 text-stone-700 placeholder-stone-400"
                    placeholder="輸入日期 (例如: 10/25)"
                  />
                )}
              </div>

              {/* 基本資訊區塊 (交通/住宿/天氣) */}
              <div className="flex flex-wrap gap-4 text-sm w-full md:w-auto">
                <div className="flex items-center gap-2 bg-white px-3 py-1.5 rounded border border-stone-200 shadow-sm">
                  <WeatherIcon type={day.weather} className="w-5 h-5" />
                  {!isPreviewMode ? (
                    <select 
                      value={day.weather}
                      onChange={(e) => {
                        const newDays = days.map(d => d.id === day.id ? { ...d, weather: e.target.value } : d);
                        setDays(newDays);
                      }}
                      className="bg-transparent outline-none cursor-pointer"
                    >
                      <option value="sunny">晴天</option>
                      <option value="cloudy">多雲</option>
                      <option value="rainy">雨天</option>
                      <option value="snowy">下雪</option>
                    </select>
                  ) : (
                    <span>{{sunny:'晴天', cloudy:'多雲', rainy:'雨天', snowy:'下雪'}[day.weather]}</span>
                  )}
                </div>

                <div className="flex items-center gap-2 bg-white px-3 py-1.5 rounded border border-stone-200 shadow-sm flex-1 md:flex-none">
                  <Train className="w-4 h-4 text-indigo-600" />
                  {!isPreviewMode ? (
                    <input 
                      type="text" 
                      value={day.transport}
                      onChange={(e) => {
                         const newDays = days.map(d => d.id === day.id ? { ...d, transport: e.target.value } : d);
                         setDays(newDays);
                      }}
                      placeholder="今日主要交通"
                      className="bg-transparent outline-none w-full md:w-32"
                    />
                  ) : (
                    <span>{day.transport || '未設定交通'}</span>
                  )}
                  
                  <span className="text-stone-300">|</span>
                  
                  {!isPreviewMode ? (
                    <select
                      value={day.ticketType}
                      onChange={(e) => {
                        const newDays = days.map(d => d.id === day.id ? { ...d, ticketType: e.target.value } : d);
                        setDays(newDays);
                      }}
                      className="bg-transparent outline-none text-stone-600 text-xs"
                    >
                      <option value="IC Card">西瓜卡/ICOCA</option>
                      <option value="Ticket">需買票</option>
                      <option value="Pass">周遊券</option>
                    </select>
                  ) : (
                    <span className="text-xs bg-stone-100 px-1 rounded text-stone-600">{day.ticketType}</span>
                  )}
                </div>

                <div className="flex items-center gap-2 bg-white px-3 py-1.5 rounded border border-stone-200 shadow-sm flex-1 md:flex-none">
                  <MapPin className="w-4 h-4 text-rose-500" />
                  {!isPreviewMode ? (
                    <input 
                      type="text" 
                      value={day.accommodation}
                      onChange={(e) => {
                         const newDays = days.map(d => d.id === day.id ? { ...d, accommodation: e.target.value } : d);
                         setDays(newDays);
                      }}
                      placeholder="當晚住宿地點"
                      className="bg-transparent outline-none w-full md:w-40"
                    />
                  ) : (
                    <span>{day.accommodation || '未設定住宿'}</span>
                  )}
                </div>
              </div>
            </div>

            {/* 內容區塊 */}
            <div className="grid grid-cols-1 lg:grid-cols-12 divide-y lg:divide-y-0 lg:divide-x divide-stone-200">
              
              {/* 左側：時間軸行程 (佔 7 等份) */}
              <div className="lg:col-span-7 p-4 md:p-6 bg-white">
                <div className="flex justify-between items-center mb-4">
                  <h2 className="text-lg font-bold text-indigo-900 flex items-center gap-2">
                    <Calendar className="w-5 h-5" /> 當日行程
                  </h2>
                  {!isPreviewMode && (
                    <button 
                      onClick={() => {
                        // 在此處需特別處理 addScheduleItem，因為 map 渲染無法直接呼叫外層 activeDay 的 function
                        // 但因為我們現在是在 map days 裡面渲染，所以我們需要傳遞 day.id 給 handler
                        const newItem = { id: Date.now(), time: '10:00', activity: '', link: '' };
                        const updatedSchedule = [...day.schedule, newItem].sort((a, b) => a.time.localeCompare(b.time));
                        const newDays = days.map(d => d.id === day.id ? { ...d, schedule: updatedSchedule } : d);
                        setDays(newDays);
                      }}
                      className="text-sm bg-indigo-50 text-indigo-600 px-2 py-1 rounded hover:bg-indigo-100 flex items-center gap-1"
                    >
                      <Plus size={14} /> 新增
                    </button>
                  )}
                </div>

                <div className="space-y-3 relative before:absolute before:inset-0 before:ml-6 before:w-0.5 before:-translate-x-px before:bg-stone-200 before:h-full">
                  {day.schedule.length === 0 && <p className="text-stone-400 text-sm ml-10 italic">尚無行程，請新增...</p>}
                  
                  {day.schedule.map((item, idx) => (
                    <div key={item.id} className="relative flex items-start group">
                      {/* 時間圓點 */}
                      <div className={`absolute left-0 ml-6 -translate-x-1/2 mt-1.5 w-3 h-3 rounded-full border-2 border-white ${idx % 2 === 0 ? 'bg-pink-400' : 'bg-indigo-400'} shadow-sm z-10`}></div>
                      
                      <div className="ml-10 w-full flex gap-3 items-start bg-stone-50/50 p-2 rounded-lg hover:bg-stone-50 transition-colors">
                        {/* 時間 */}
                        <div className="w-16 flex-shrink-0">
                          {!isPreviewMode ? (
                            <input
                              type="time"
                              value={item.time}
                              onChange={(e) => {
                                const newSchedule = day.schedule.map(s => s.id === item.id ? { ...s, time: e.target.value } : s).sort((a, b) => a.time.localeCompare(b.time));
                                const newDays = days.map(d => d.id === day.id ? { ...d, schedule: newSchedule } : d);
                                setDays(newDays);
                              }}
                              className="font-mono font-semibold text-stone-600 bg-transparent outline-none w-full"
                            />
                          ) : (
                            <span className="font-mono font-semibold text-stone-600">{item.time}</span>
                          )}
                        </div>

                        {/* 活動內容 */}
                        <div className="flex-grow space-y-1">
                          {!isPreviewMode ? (
                            <input
                              type="text"
                              value={item.activity}
                              onChange={(e) => {
                                const newSchedule = day.schedule.map(s => s.id === item.id ? { ...s, activity: e.target.value } : s);
                                const newDays = days.map(d => d.id === day.id ? { ...d, schedule: newSchedule } : d);
                                setDays(newDays);
                              }}
                              className="font-medium text-stone-800 bg-transparent border-b border-transparent focus:border-indigo-300 outline-none w-full"
                              placeholder="行程活動..."
                            />
                          ) : (
                            <div className="font-medium text-stone-800">{item.activity}</div>
                          )}

                          {/* 連結欄位 */}
                          <div className="flex items-center gap-2">
                            {!isPreviewMode ? (
                              <>
                                <ExternalLink size={12} className="text-stone-400" />
                                <input
                                  type="text"
                                  value={item.link}
                                  onChange={(e) => {
                                    const newSchedule = day.schedule.map(s => s.id === item.id ? { ...s, link: e.target.value } : s);
                                    const newDays = days.map(d => d.id === day.id ? { ...d, schedule: newSchedule } : d);
                                    setDays(newDays);
                                  }}
                                  className="text-xs text-blue-500 bg-transparent outline-none w-full placeholder-stone-300"
                                  placeholder="貼上相關連結 (Google Maps, 餐廳官網...)"
                                />
                              </>
                            ) : item.link && (
                              <a href={item.link} target="_blank" rel="noopener noreferrer" className="text-xs text-blue-600 hover:underline flex items-center gap-1">
                                <ExternalLink size={10} /> 相關連結
                              </a>
                            )}
                          </div>
                        </div>

                        {/* 刪除按鈕 */}
                        {!isPreviewMode && (
                          <button
                            onClick={() => {
                              const newSchedule = day.schedule.filter(s => s.id !== item.id);
                              const newDays = days.map(d => d.id === day.id ? { ...d, schedule: newSchedule } : d);
                              setDays(newDays);
                            }}
                            className="text-stone-300 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity"
                          >
                            <Trash2 size={16} />
                          </button>
                        )}
                      </div>
                    </div>
                  ))}
                </div>
              </div>

              {/* 右側：購物與美食 (佔 5 等份) */}
              <div className="lg:col-span-5 flex flex-col divide-y divide-stone-200">
                
                {/* 購物地圖 */}
                <div className="p-4 md:p-6 bg-stone-50/30">
                  <div className="flex justify-between items-center mb-3">
                    <h3 className="font-bold text-indigo-900 flex items-center gap-2">
                      <Ticket className="w-4 h-4 text-emerald-600" /> 購物與逛街
                    </h3>
                    {!isPreviewMode && (
                      <button 
                        onClick={() => {
                           const newItem = { id: Date.now(), name: '', location: '' };
                           const newDays = days.map(d => d.id === day.id ? { ...d, shopping: [...d.shopping, newItem] } : d);
                           setDays(newDays);
                        }}
                        className="text-xs bg-emerald-50 text-emerald-600 px-2 py-1 rounded hover:bg-emerald-100"
                      >
                        + 新增
                      </button>
                    )}
                  </div>
                  <div className="space-y-2">
                    {day.shopping.length === 0 && <p className="text-stone-400 text-xs italic">尚無購物清單</p>}
                    {day.shopping.map(shop => (
                      <div key={shop.id} className="bg-white p-2 rounded shadow-sm border border-stone-100 flex gap-2 items-center group">
                         <div className="flex-grow grid grid-cols-2 gap-2">
                            {!isPreviewMode ? (
                              <>
                                <input 
                                  className="text-sm font-medium outline-none text-stone-800 placeholder-stone-300" 
                                  placeholder="店家名稱"
                                  value={shop.name}
                                  onChange={(e) => {
                                    const newShopping = day.shopping.map(s => s.id === shop.id ? { ...s, name: e.target.value } : s);
                                    const newDays = days.map(d => d.id === day.id ? { ...d, shopping: newShopping } : d);
                                    setDays(newDays);
                                  }}
                                />
                                <input 
                                  className="text-xs text-stone-500 outline-none placeholder-stone-300" 
                                  placeholder="地點/備註"
                                  value={shop.location}
                                  onChange={(e) => {
                                    const newShopping = day.shopping.map(s => s.id === shop.id ? { ...s, location: e.target.value } : s);
                                    const newDays = days.map(d => d.id === day.id ? { ...d, shopping: newShopping } : d);
                                    setDays(newDays);
                                  }}
                                />
                              </>
                            ) : (
                              <>
                                <span className="text-sm font-medium text-stone-800">{shop.name}</span>
                                <span className="text-xs text-stone-500">{shop.location}</span>
                              </>
                            )}
                         </div>
                         {!isPreviewMode && (
                            <button 
                              onClick={() => {
                                const newShopping = day.shopping.filter(s => s.id !== shop.id);
                                const newDays = days.map(d => d.id === day.id ? { ...d, shopping: newShopping } : d);
                                setDays(newDays);
                              }}
                              className="text-stone-300 hover:text-red-400"
                            ><Trash2 size={14} /></button>
                         )}
                      </div>
                    ))}
                  </div>
                </div>

                {/* 美食清單 */}
                <div className="p-4 md:p-6 bg-white flex-grow">
                  <h3 className="font-bold text-indigo-900 flex items-center gap-2 mb-3">
                    <Utensils className="w-4 h-4 text-orange-500" /> 美食筆記
                  </h3>
                  
                  {/* 三餐規劃 */}
                  <div className="grid grid-cols-1 gap-2 mb-4">
                    {['breakfast', 'lunch', 'dinner'].map((meal) => (
                       <div key={meal} className="flex items-center text-sm border-b border-stone-100 py-1">
                          <span className="w-12 text-stone-500 font-medium">
                            {meal === 'breakfast' ? '早餐' : meal === 'lunch' ? '午餐' : '晚餐'}
                          </span>
                          {!isPreviewMode ? (
                            <input 
                              type="text"
                              value={day.food[meal]}
                              onChange={(e) => {
                                const newDays = days.map(d => d.id === day.id ? { ...d, food: { ...d.food, [meal]: e.target.value } } : d);
                                setDays(newDays);
                              }}
                              className="flex-grow outline-none text-stone-700 placeholder-stone-300"
                              placeholder="規劃餐廳..."
                            />
                          ) : (
                            <span className="flex-grow text-stone-700">{day.food[meal]}</span>
                          )}
                       </div>
                    ))}
                  </div>

                  {/* 想吃清單 */}
                  <div className="mt-4">
                     <div className="flex justify-between items-center mb-2">
                        <span className="text-xs font-bold text-stone-400 uppercase tracking-wider">Wishlist</span>
                        {!isPreviewMode && (
                          <button 
                            onClick={() => {
                              const newItem = { id: Date.now(), name: '', checked: false };
                              const newWishlist = [...day.food.wishlist, newItem];
                              const newDays = days.map(d => d.id === day.id ? { ...d, food: { ...d.food, wishlist: newWishlist } } : d);
                              setDays(newDays);
                            }}
                            className="text-xs text-indigo-500 hover:text-indigo-700"
                          >+ 新增</button>
                        )}
                     </div>
                     <div className="space-y-1">
                        {day.food.wishlist.map(item => (
                           <div key={item.id} className="flex items-center gap-2 text-sm group">
                              <input 
                                type="checkbox" 
                                checked={item.checked}
                                onChange={(e) => {
                                  const newWishlist = day.food.wishlist.map(w => w.id === item.id ? { ...w, checked: e.target.checked } : w);
                                  const newDays = days.map(d => d.id === day.id ? { ...d, food: { ...d.food, wishlist: newWishlist } } : d);
                                  setDays(newDays);
                                }}
                                className="rounded text-pink-500 focus:ring-pink-500"
                              />
                              {!isPreviewMode ? (
                                <input 
                                  value={item.name}
                                  onChange={(e) => {
                                    const newWishlist = day.food.wishlist.map(w => w.id === item.id ? { ...w, name: e.target.value } : w);
                                    const newDays = days.map(d => d.id === day.id ? { ...d, food: { ...d.food, wishlist: newWishlist } } : d);
                                    setDays(newDays);
                                  }}
                                  className={`flex-grow outline-none bg-transparent ${item.checked ? 'line-through text-stone-400' : 'text-stone-700'}`}
                                  placeholder="想吃的小吃..."
                                />
                              ) : (
                                <span className={`flex-grow ${item.checked ? 'line-through text-stone-400' : 'text-stone-700'}`}>{item.name}</span>
                              )}
                              {!isPreviewMode && (
                                <button 
                                  onClick={() => {
                                    const newWishlist = day.food.wishlist.filter(w => w.id !== item.id);
                                    const newDays = days.map(d => d.id === day.id ? { ...d, food: { ...d.food, wishlist: newWishlist } } : d);
                                    setDays(newDays);
                                  }}
                                  className="text-stone-300 hover:text-red-400 opacity-0 group-hover:opacity-100"
                                ><Trash2 size={12} /></button>
                              )}
                           </div>
                        ))}
                     </div>
                  </div>
                </div>

              </div>
            </div>

            {/* 底部備註區 */}
            <div className="bg-yellow-50/50 p-4 border-t border-stone-200">
               <div className="flex items-start gap-2">
                  <AlertCircle className="w-5 h-5 text-yellow-600 mt-1" />
                  <div className="w-full">
                     <h4 className="text-sm font-bold text-yellow-700 mb-1">今日備註 & 提醒</h4>
                     {!isPreviewMode ? (
                        <textarea 
                          className="w-full bg-transparent outline-none text-sm text-stone-700 min-h-[60px] resize-none placeholder-yellow-700/30"
                          placeholder="例如：要提早買票、記得帶行動電源、晚上有祭典..."
                          value={day.notes}
                          onChange={(e) => {
                            const newDays = days.map(d => d.id === day.id ? { ...d, notes: e.target.value } : d);
                            setDays(newDays);
                          }}
                        />
                     ) : (
                        <p className="text-sm text-stone-700 whitespace-pre-wrap">{day.notes}</p>
                     )}
                  </div>
               </div>
            </div>
          </div>
        ))}
      </main>

      {/* 頁尾 */}
      {!isPreviewMode && (
         <footer className="text-center p-6 text-stone-400 text-sm">
            Kyoto Trip Planner &copy; 2024 - Built with React
         </footer>
      )}
    </div>
  );
}
