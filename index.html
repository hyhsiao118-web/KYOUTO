import React, { useState } from 'react';
import { 
  Calendar, 
  MapPin, 
  ShoppingBag, 
  Train, 
  Info, 
  CheckCircle2, 
  Plus, 
  Trash2, 
  Bike, 
  CloudSnow, 
  Coffee,
  ExternalLink,
  Copy,
  Check
} from 'lucide-react';

const App = () => {
  const [activeDay, setActiveDay] = useState(1);
  const [customItems, setCustomItems] = useState({});
  const [showAddModal, setShowAddModal] = useState(false);
  const [newItem, setNewItem] = useState({ title: '', time: '' });
  const [copied, setCopied] = useState(false);

  // åˆå§‹è¡Œç¨‹æ•¸æ“š
  const initialData = {
    1: {
      date: '2/8 (æ—¥)',
      title: 'æŠµé”äº¬éƒ½ï¼šäº¬éƒ½è»Šç«™å¤§è§£é–',
      schedule: [
        { time: '08:05', activity: 'æ¡ƒåœ’æ©Ÿå ´èµ·é£› (CI156)', note: '5:00 æ´¾è»Šå‡ºç™¼' },
        { time: '11:35', activity: 'æŠµé”é—œè¥¿æ©Ÿå ´ T1', note: 'å¾€ C å‡ºå£æ­åˆ©æœ¨æ´¥å·´å£«' },
        { time: '14:00', activity: 'äº¬éƒ½è»Šç«™ç”¨é¤', note: 'æ¨è–¦æ‹‰éºµå°è·¯' },
        { time: '15:00', activity: 'ç´ å±…æ—…èˆ Check-in', note: 'è·é›¢æ¸…æ°´å¯ºæ­¥è¡Œ10åˆ†' },
      ],
      shopping: [
        { name: 'Porta åœ°ä¸‹è¡—', desc: 'æ—¥ç³»æœé£¾èˆ‡æµè¡Œé›œè²¨' },
        { name: 'Bic Camera', desc: 'å¤§å‹é›»å™¨ã€å¹é¢¨æ©Ÿã€ç›¸æ©Ÿ' },
        { name: 'JR äº¬éƒ½ä¼Šå‹¢ä¸¹', desc: 'å°ˆæ«ƒåŒ–å¦å“èˆ‡ç²¾å“' }
      ],
      tips: 'äº¬éƒ½è»Šç«™è½‰ä¹˜è¤‡é›œï¼Œå…ˆå­˜å¥½è»Šç«™åœ°åœ–ã€‚'
    },
    2: {
      date: '2/9 (ä¸€)',
      title: 'å¤æ„æ¼«æ­¥ï¼šä¼è¦‹èˆ‡å®‡æ²»',
      schedule: [
        { time: '09:00', activity: 'ä¼è¦‹æ¡ƒå±±è€è¡—', note: 'é…’è—å·¡ç¦®' },
        { time: '11:00', activity: 'ä¼è¦‹åçŸ³èˆŸ', note: 'éœ€æå‰ç¢ºèªç­æ¬¡' },
        { time: '13:00', activity: 'æ­è»Šå‰å¾€å®‡æ²»', note: 'äº¬é˜ªé›»è»Šç´„20åˆ†' },
        { time: '14:00', activity: 'å¹³ç­‰é™¢ & æŠ¹èŒ¶é«”é©—', note: 'é³³å‡°å ‚å¿…çœ‹' },
      ],
      shopping: [
        { name: 'ä¸­æ‘è—¤å‰æœ¬åº—', desc: 'å®‡æ²»æŠ¹èŒ¶é»å¿ƒä¼´æ‰‹ç¦®' },
        { name: 'ä¼è¦‹é…’è—', desc: 'ç‰¹è‰²æ¸…é…’åœ°é…’' }
      ],
      tips: 'ä¼è¦‹åˆ°å®‡æ²»å¾ˆè¿‘ï¼Œé©åˆæ’åœ¨åŒä¸€å¤©ã€‚'
    },
    3: {
      date: '2/10 (äºŒ)',
      title: 'äº¬éƒ½å¸‚å€ï¼šå–®è»Šæˆ–æ­¥è¡Œ',
      schedule: [
        { time: '09:30', activity: 'å– e-Bike / æ¸…æ°´å¯º', note: 'æ—©èµ·é¿é–‹äººæ½®' },
        { time: '11:00', activity: 'å…«å‚ç¥ç¤¾ & ç¥‡åœ’', note: 'èŠ±è¦‹å°è·¯æ•£æ­¥' },
        { time: '13:00', activity: 'é´¨å·æ²³å²¸é¨è¡Œ', note: 'äº«å—å¹³å¦æ²³å²¸é¢¨å…‰' },
        { time: '17:00', activity: 'æ²³åŸç”ºé‚„è»Š/æ™šé¤', note: 'ä¸å¤œé¨æ›´å®‰å…¨' },
      ],
      shopping: [
        { name: 'SOUãƒ»SOU', desc: 'äº¬éƒ½è³ªæ„Ÿå°èŠ±é›œè²¨' },
        { name: 'Nintendo KYOTO', desc: 'ä»»å¤©å ‚å°ˆè³£åº— (é«˜å³¶å±‹S.C.)' },
        { name: 'æ–°äº¬æ¥µå•†åº—è¡—', desc: 'è—¥å¦ã€å¤è‘—ã€ABC-MART' }
      ],
      tips: '2æœˆé¨è»Šé¢¨å¤§ï¼Œå‹™å¿…æˆ´ä¸Šæ‰‹å¥—é˜²å¯’ã€‚'
    },
    4: {
      date: '2/11 (ä¸‰)',
      title: 'æ·±å±±ç¥•å¢ƒï¼šç¾å±±èŒ…è‘ºä¹‹é‡Œ',
      schedule: [
        { time: '08:30', activity: 'äº¬éƒ½ç§Ÿè»Šå‡ºç™¼', note: 'ç¢ºèªé…å‚™é›ªèƒ' },
        { time: '11:00', activity: 'æŠµé”ç¾å±±ç”º', note: 'åƒè§€æ°‘ä¿—è³‡æ–™é¤¨' },
        { time: '15:00', activity: 'æ°‘å®¿ Check-in', note: 'é«”é©—é„‰é–“å¯§éœ' },
      ],
      shopping: [
        { name: 'ç¾å±±ç‰›å¥¶', desc: 'è¶…æ¿ƒéƒä¹³è£½å“ã€å¸ƒä¸' },
        { name: 'ç¾å±±ç‰¹ç”¢åº—', desc: 'åœ¨åœ°å·¥è—å“ã€æ‰‹å·¥æœé†¬' }
      ],
      tips: 'å±±å€è·¯é¢æ˜“çµå†°ï¼Œé–‹è»Šé ˆä¿æŒå®‰å…¨è·é›¢ã€‚'
    },
    5: {
      date: '2/12 (å››)',
      title: 'åµå±±é¢¨å…‰ & ç§»å¸«å¤§é˜ª',
      schedule: [
        { time: '10:00', activity: 'åµå±±æ¸¡æœˆæ©‹', note: 'ç«¹æ—å°å¾‘æ‹ç…§' },
        { time: '15:00', activity: 'æ­¸é‚„è»Šè¼›', note: 'äº¬éƒ½è»Šç«™å‘¨é‚Šé‚„è»Š' },
        { time: '18:00', activity: 'ç§»å‹•è‡³å¤§é˜ª', note: 'å»ºè­°æ­ä¹˜ JR æ–°å¿«é€Ÿ' },
      ],
      shopping: [
        { name: 'åµå±±å•†åº—è¡—', desc: 'ç‰¹è‰²å·¥è—å“ã€æ‰‡å­' },
        { name: 'æ¢…ç”° LUCUA', desc: 'å¤§é˜ªæµè¡Œæœé£¾å¤§æœ¬ç‡Ÿ' }
      ],
      tips: 'ç§»å‹•åˆ°å¤§é˜ªå¾Œï¼Œå¤§ä»¶è¡Œæå¯å…ˆæ”¾é£¯åº—ã€‚'
    },
    6: {
      date: '2/13 (äº”)',
      title: 'å£¯éº—åœ‹å¯¶ï¼šå§¬è·¯åŸä¸€æ—¥éŠ',
      schedule: [
        { time: '08:00', activity: 'æ–°å¤§é˜ªç«™å‡ºç™¼', note: 'æ­ä¹˜æ–°å¹¹ç·šæœ€å¿«' },
        { time: '09:30', activity: 'åƒè§€å§¬è·¯åŸ', note: 'ç™»ä¸Šå¤©å®ˆé–£ä¿¯ç°' },
        { time: '13:00', activity: 'å¥½å¤åœ’', note: 'è²·è¯ç¥¨æ›´åˆ’ç®—' },
        { time: '18:00', activity: 'å¿ƒé½‹æ©‹é€›è¡—', note: 'æ„Ÿå—å¤§é˜ªå¤œç”Ÿæ´»' },
      ],
      shopping: [
        { name: 'piole å§¬è·¯', desc: 'å§¬è·¯ç«™æ—è³¼ç‰©ä¸­å¿ƒ' },
        { name: 'å¿ƒé½‹æ©‹ç­‹', desc: 'è—¥å¦æƒè²¨ã€ç™¾è²¨ PARCO' },
        { name: 'å¤§åœ‹è—¥å¦', desc: 'åƒ¹æ ¼ç«¶çˆ­åŠ›å¼·' }
      ],
      tips: 'å»ºè­°è³¼è²· JR è¥¿æ—¥æœ¬ä¸€æ—¥åˆ¸ï¼Œçœä¸‹æ–°å¹¹ç·šæ—…è²»ã€‚'
    },
    7: {
      date: '2/14 (å…­)',
      title: 'æœ€å¾Œè¡åˆº & æ­¸é€”',
      schedule: [
        { time: '10:00', activity: 'å¾€æ©Ÿå ´ç§»å‹•', note: 'è¡Œæå¯„æ”¾ Rinku Town' },
        { time: '12:00', activity: 'Rinku Outlet', note: 'æœ€å¾Œæ¡è²·æˆ°å ´' },
        { time: '17:00', activity: 'è¾¦ç†ç™»æ©Ÿ', note: 'T1 èˆªå»ˆ' },
        { time: '19:00', activity: 'é£›æ©Ÿèµ·é£› (CI173)', note: 'è¿”å›æº«æš–çš„å®¶' },
      ],
      shopping: [
        { name: 'Rinku Premium Outlets', desc: 'åœ‹éš›å“ç‰Œæœ€å¾ŒæŠ˜æ‰£' },
        { name: 'æ©Ÿå ´å…ç¨…åº—', desc: 'ç™½è‰²æˆ€äººã€Royceå·§å…‹åŠ›' }
      ],
      tips: 'Outlet è¼ƒå¤§ï¼Œå»ºè­°å…ˆé–å®š 2-3 å€‹æƒ³çœ‹çš„å“ç‰Œã€‚'
    }
  };

  const copyItineraryToClipboard = () => {
    let text = "ğŸŒŸ äº¬éƒ½ãƒ»å¤§é˜ªå†¬æ—¥æ—…è¡Œç¨‹ç¸½è¦½ ğŸŒŸ\n\n";
    Object.keys(initialData).forEach(day => {
      const d = initialData[day];
      text += `ğŸ“… Day ${day} - ${d.date}\nğŸ“ ${d.title}\n`;
      d.schedule.forEach(s => {
        text += `  â° ${s.time} ${s.activity} (${s.note})\n`;
      });
      text += `ğŸ›ï¸ æ¨è–¦é€›è¡—: ${d.shopping.map(s => s.name).join(', ')}\n\n`;
    });

    const textArea = document.createElement("textarea");
    textArea.value = text;
    document.body.appendChild(textArea);
    textArea.select();
    try {
      document.execCommand('copy');
      setCopied(true);
      setTimeout(() => setCopied(false), 3000);
    } catch (err) {
      console.error('ç„¡æ³•è¤‡è£½æ–‡å­—', err);
    }
    document.body.removeChild(textArea);
  };

  const handleAddItem = (e) => {
    e.preventDefault();
    if (!newItem.title) return;
    const currentCustom = customItems[activeDay] || [];
    setCustomItems({
      ...customItems,
      [activeDay]: [...currentCustom, { ...newItem, id: Date.now() }]
    });
    setNewItem({ title: '', time: '' });
    setShowAddModal(false);
  };

  const deleteItem = (dayId, itemId) => {
    setCustomItems({
      ...customItems,
      [dayId]: customItems[dayId].filter(item => item.id !== itemId)
    });
  };

  return (
    <div className="min-h-screen bg-slate-50 flex flex-col font-sans text-slate-800">
      {/* Header */}
      <header className="bg-indigo-900 text-white p-6 shadow-lg sticky top-0 z-20">
        <div className="max-w-4xl mx-auto flex justify-between items-center">
          <div>
            <h1 className="text-xl md:text-2xl font-bold flex items-center gap-2">
              <MapPin className="text-red-400" /> äº¬éƒ½ãƒ»å¤§é˜ªå†¬æ—¥æ—…
            </h1>
            <p className="text-indigo-200 text-xs md:text-sm mt-1">2026.02.08 - 02.14 | èˆ‡åª½åª½çš„æ¼«æ—…</p>
          </div>
          <button 
            onClick={copyItineraryToClipboard}
            className={`flex items-center gap-2 px-3 py-2 rounded-lg transition-all text-xs font-bold ${
              copied ? 'bg-emerald-500 text-white' : 'bg-white/10 hover:bg-white/20 text-white border border-white/20'
            }`}
          >
            {copied ? <Check size={16} /> : <Copy size={16} />}
            {copied ? 'å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿' : 'è¤‡è£½æ–‡å­—è¡Œç¨‹'}
          </button>
        </div>
      </header>

      {/* Day Selector */}
      <div className="bg-white border-b sticky top-[80px] md:top-[88px] z-10 overflow-x-auto no-scrollbar">
        <div className="max-w-4xl mx-auto flex px-2 md:px-4">
          {[1, 2, 3, 4, 5, 6, 7].map((day) => (
            <button
              key={day}
              onClick={() => setActiveDay(day)}
              className={`flex-none px-4 md:px-6 py-4 text-sm font-bold transition-all border-b-2 ${
                activeDay === day 
                ? 'border-indigo-600 text-indigo-600' 
                : 'border-transparent text-slate-400 hover:text-slate-600'
              }`}
            >
              Day {day}
            </button>
          ))}
        </div>
      </div>

      <main className="flex-1 max-w-4xl mx-auto w-full p-4 md:p-6 pb-24">
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          
          {/* Main Itinerary */}
          <div className="lg:col-span-2 space-y-6">
            <section className="bg-white rounded-2xl shadow-sm p-5 md:p-6 border border-slate-200">
              <div className="flex justify-between items-start mb-6">
                <div>
                  <span className="text-indigo-600 font-bold text-xs uppercase tracking-wider">{initialData[activeDay].date}</span>
                  <h2 className="text-xl md:text-2xl font-bold mt-1">{initialData[activeDay].title}</h2>
                </div>
                <button 
                  onClick={() => setShowAddModal(true)}
                  className="bg-indigo-50 text-indigo-600 p-2 rounded-full hover:bg-indigo-100 transition-colors"
                >
                  <Plus size={20} />
                </button>
              </div>

              <div className="space-y-6">
                {initialData[activeDay].schedule.map((item, index) => (
                  <div key={index} className="flex gap-3 md:gap-4 relative">
                    {index !== initialData[activeDay].schedule.length - 1 && (
                      <div className="absolute left-[7px] top-6 w-0.5 h-full bg-slate-100"></div>
                    )}
                    <div className="w-4 h-4 rounded-full bg-indigo-500 mt-1.5 z-10 shadow-[0_0_0_4px_rgba(99,102,241,0.1)]"></div>
                    <div className="flex-1 pb-4">
                      <div className="flex flex-col md:flex-row md:justify-between md:items-baseline">
                        <span className="text-xs font-bold text-slate-400 mb-1 md:mb-0 md:w-16">{item.time}</span>
                        <h3 className="text-base md:text-lg font-bold flex-1">{item.activity}</h3>
                      </div>
                      <div className="mt-2 md:ml-16">
                        <span className="text-slate-600 text-xs md:text-sm bg-slate-50 px-3 py-1.5 rounded-lg border border-slate-100 inline-block">
                          {item.note}
                        </span>
                      </div>
                    </div>
                  </div>
                ))}

                {/* Custom Items */}
                {customItems[activeDay]?.map((item) => (
                  <div key={item.id} className="flex gap-4 relative group">
                    <div className="w-4 h-4 rounded-full bg-emerald-500 mt-1.5 z-10 shadow-[0_0_0_4px_rgba(16,185,129,0.1)]"></div>
                    <div className="flex-1 pb-4">
                      <div className="flex justify-between items-baseline">
                        <span className="text-xs font-bold text-emerald-600 w-16">{item.time || 'åŠ è¡Œç¨‹'}</span>
                        <h3 className="text-base md:text-lg font-bold flex-1 text-emerald-800">{item.title}</h3>
                        <button 
                          onClick={() => deleteItem(activeDay, item.id)}
                          className="text-slate-300 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity"
                        >
                          <Trash2 size={16} />
                        </button>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </section>

            {/* Preparation Tips */}
            <section className="bg-amber-50 rounded-2xl p-5 border border-amber-100 flex gap-4">
              <div className="bg-amber-100 p-3 rounded-xl h-fit">
                <Info className="text-amber-600" size={20} />
              </div>
              <div>
                <h4 className="font-bold text-amber-900 text-sm md:text-base">å°æé†’</h4>
                <p className="text-amber-800 text-xs md:text-sm mt-1 leading-relaxed">{initialData[activeDay].tips}</p>
              </div>
            </section>
          </div>

          {/* Shopping Sidebar */}
          <div className="space-y-6">
            <section className="bg-white rounded-2xl shadow-sm p-6 border border-slate-200">
              <div className="flex items-center gap-2 mb-4">
                <ShoppingBag className="text-rose-500" />
                <h3 className="font-bold text-lg">ä»Šæ—¥æ¨è–¦é€›è¡—</h3>
              </div>
              <div className="space-y-3">
                {initialData[activeDay].shopping.map((shop, index) => (
                  <div key={index} className="p-4 rounded-xl border border-slate-100 hover:bg-rose-50 hover:border-rose-100 transition-all cursor-default group">
                    <div className="font-bold text-slate-800 text-sm group-hover:text-rose-700">{shop.name}</div>
                    <div className="text-[11px] text-slate-500 mt-1">{shop.desc}</div>
                  </div>
                ))}
              </div>
            </section>

            {/* Status Card */}
            <section className="bg-white rounded-2xl shadow-sm p-6 border border-slate-200">
               <h3 className="font-bold text-sm text-slate-400 uppercase tracking-widest mb-4">æ—…è¡Œå¿…å‚™ç‹€æ…‹</h3>
               <div className="grid grid-cols-2 gap-4">
                  <div className="text-center p-3 bg-blue-50 rounded-xl">
                    <CloudSnow className="mx-auto mb-1 text-blue-500" size={20} />
                    <div className="text-[10px] text-blue-600 font-bold">é å ±æ°£æº«</div>
                    <div className="font-bold text-blue-800">2Â° - 9Â°C</div>
                  </div>
                  <div className="text-center p-3 bg-orange-50 rounded-xl">
                    <Coffee className="mx-auto mb-1 text-orange-500" size={20} />
                    <div className="text-[10px] text-orange-600 font-bold">ç†±é£²æ¨è–¦</div>
                    <div className="font-bold text-orange-800">å®‡æ²»æŠ¹èŒ¶</div>
                  </div>
               </div>
            </section>
          </div>
        </div>
      </main>

      {/* Add Item Modal */}
      {showAddModal && (
        <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden">
            <div className="p-6">
              <h3 className="text-xl font-bold mb-4">æ–°å¢è¡Œç¨‹ç´€éŒ„</h3>
              <form onSubmit={handleAddItem} className="space-y-4">
                <div>
                  <label className="block text-[10px] font-bold text-slate-400 uppercase mb-1">æŠµé”æ™‚é–“</label>
                  <input 
                    type="text" 
                    value={newItem.time}
                    onChange={(e) => setNewItem({...newItem, time: e.target.value})}
                    placeholder="ä¾‹å¦‚ 14:30"
                    className="w-full px-4 py-2 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  />
                </div>
                <div>
                  <label className="block text-[10px] font-bold text-slate-400 uppercase mb-1">æ´»å‹•å…§å®¹</label>
                  <input 
                    type="text" 
                    value={newItem.title}
                    onChange={(e) => setNewItem({...newItem, title: e.target.value})}
                    placeholder="ä¾‹å¦‚ï¼šéŒ¦å¸‚å ´åƒåˆé¤"
                    className="w-full px-4 py-2 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    autoFocus
                  />
                </div>
                <div className="flex gap-3 pt-4">
                  <button 
                    type="button"
                    onClick={() => setShowAddModal(false)}
                    className="flex-1 px-4 py-2 text-sm font-bold text-slate-500 hover:bg-slate-100 rounded-lg transition-colors"
                  >
                    å–æ¶ˆ
                  </button>
                  <button 
                    type="submit"
                    className="flex-1 px-4 py-2 text-sm font-bold text-white bg-indigo-600 hover:bg-indigo-700 rounded-lg transition-colors"
                  >
                    ç¢ºå®šæ–°å¢
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      )}

      {/* Toast Notification for Copying */}
      {copied && (
        <div className="fixed top-24 left-1/2 -translate-x-1/2 bg-emerald-600 text-white px-6 py-3 rounded-full shadow-2xl z-50 animate-bounce font-bold text-sm">
          âœ“ è¡Œç¨‹æ–‡å­—å·²æˆåŠŸè¤‡è£½ï¼
        </div>
      )}
    </div>
  );
};

export default App;